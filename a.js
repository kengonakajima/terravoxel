s=document.createElement('script');  s.src="https://rawgit.com/mrdoob/three.js/master/examples/js/libs/stats.min.js";         document.head.appendChild(s); s.onload=function(){
s=document.createElement('script');  s.src="https://rawgit.com/mrdoob/three.js/master/examples/js/libs/dat.gui.min.js";       document.head.appendChild(s); s.onload=function(){
s=document.createElement('script');  s.src="https://rawgit.com/mrdoob/three.js/master/build/three.js";                        document.head.appendChild(s); s.onload=function(){
s=document.createElement('script');  s.src="https://rawgit.com/mrdoob/three.js/master/examples/js/controls/FlyControls.js"; document.head.appendChild(s); s.onload=function(){
s=document.createElement('script');  s.src="https://rawgit.com/mrdoob/three.js/master/examples/js/controls/OrbitControls.js"; document.head.appendChild(s); s.onload=function(){
img=document.createElement('img'); img.src="test.jpg"; img.onload=function() {
ll=[[50,50,50,45,60,78,72,82,92,79,74,78,80,76,69,62,62,71,74,92,101,98,87,90,105,89,72,67,69,58,55,55,55,62,70,64,47,65,81,101,94,79,71,73,59,55,57,81,87,81,74,76,72,60,52,56,62,72,78,60,49,56,57,62],[49,50,48,47,63,80,78,81,77,79,80,72,71,74,67,66,71,71,66,88,102,107,98,93,106,108,69,67,61,60,56,49,53,57,58,52,45,58,79,100,89,79,78,72,57,52,89,122,123,120,118,106,76,47,49,50,57,62,65,62,60,63,72,74],[50,49,49,49,62,73,73,70,73,78,80,76,61,59,57,71,79,59,65,86,104,106,107,105,88,89,77,63,58,65,66,53,51,57,56,49,44,44,69,88,90,79,66,63,66,57,97,129,140,141,140,112,71,55,49,52,50,56,61,61,62,57,56,61],[53,50,51,56,50,46,47,55,61,60,60,65,62,52,56,62,60,59,80,89,136,141,133,122,123,104,98,70,73,73,67,53,55,64,61,48,47,42,53,74,76,68,57,62,62,57,96,127,119,92,81,80,62,60,52,50,52,56,57,58,54,49,49,44],[58,53,50,56,48,42,41,47,34,38,46,47,50,53,60,53,52,66,79,110,159,164,162,182,181,152,113,74,82,80,72,50,48,60,63,49,41,45,53,63,69,59,52,56,56,61,80,95,107,88,67,43,35,47,57,53,55,55,55,52,49,47,49,55],[55,50,57,66,50,45,44,44,44,48,48,48,50,56,56,56,58,71,72,108,168,196,227,228,181,156,103,72,73,75,68,59,56,50,56,45,45,56,57,59,60,52,52,56,65,59,62,81,83,74,63,59,46,46,50,47,52,57,49,47,50,46,56,64],[57,57,72,64,51,46,42,45,51,52,53,51,51,53,57,66,71,71,58,108,168,192,231,217,157,152,90,66,56,60,70,72,73,71,58,47,48,50,50,62,61,52,49,56,66,57,57,68,69,66,69,57,62,50,44,49,55,55,49,52,59,62,62,59],[53,57,63,60,64,65,61,58,56,58,56,58,57,51,57,73,72,66,60,89,127,171,173,147,147,143,90,63,58,64,69,74,76,78,67,56,48,49,55,63,57,43,43,49,60,57,56,60,63,66,66,57,50,47,49,55,50,52,52,57,59,65,63,65],[51,56,56,60,70,71,70,62,62,57,49,57,56,53,56,66,67,58,61,86,81,130,156,146,171,132,85,71,72,70,66,63,63,63,66,64,61,56,59,57,44,41,40,50,65,55,50,50,46,56,65,60,41,46,46,50,47,50,55,50,50,58,60,62],[52,51,53,58,58,58,62,59,61,57,56,52,52,51,54,57,57,56,60,85,82,113,148,163,146,101,75,69,69,72,61,56,60,56,66,71,63,57,61,58,46,42,46,56,57,43,46,55,49,50,57,57,56,47,53,56,59,59,52,49,50,50,55,59],[51,61,61,57,57,61,58,58,63,63,64,55,51,58,57,51,51,54,63,69,90,102,104,96,80,75,74,67,51,59,66,69,68,57,60,64,64,66,61,58,63,62,59,52,47,46,41,46,46,44,44,49,57,58,63,64,62,60,55,52,60,50,44,49],[75,77,73,69,78,80,58,41,60,77,69,51,56,69,62,48,45,46,61,61,60,72,72,61,62,64,67,68,60,63,85,109,87,57,58,66,70,70,60,58,62,62,62,57,47,47,45,41,44,44,47,49,53,53,61,64,58,56,57,59,62,57,52,55],[103,98,101,95,82,72,52,45,51,67,72,61,67,67,79,86,86,86,63,47,45,45,50,53,51,56,61,77,113,94,88,113,94,75,69,72,79,60,53,58,52,50,53,56,53,57,58,48,40,44,59,56,56,58,57,58,56,61,65,68,70,64,60,62],[93,91,91,88,73,52,52,51,51,51,61,73,67,89,138,149,137,117,81,44,45,45,51,60,58,51,63,121,131,99,99,113,83,78,85,83,79,57,56,56,52,49,49,53,56,61,56,47,47,43,52,59,58,64,60,61,57,62,63,64,65,62,59,56],[73,71,59,58,59,59,61,59,59,54,62,76,68,126,161,151,154,154,126,88,57,51,57,57,68,67,73,121,140,123,105,105,72,65,79,82,82,74,60,55,50,55,56,49,49,59,62,62,60,52,50,56,60,59,58,58,57,50,50,49,47,52,57,56],[48,59,59,66,67,72,67,64,58,48,62,71,104,131,156,169,162,145,121,118,67,45,53,53,67,75,69,86,122,123,104,98,71,54,60,79,85,86,74,56,50,59,60,55,49,52,60,73,65,55,52,59,57,52,55,52,55,52,47,44,50,52,55,56],[51,58,56,63,74,70,64,61,62,61,61,77,107,108,130,151,149,112,98,83,61,56,59,61,63,60,51,53,86,100,113,93,74,56,56,57,64,77,72,54,55,62,62,57,47,49,49,63,62,57,59,60,55,55,57,51,56,55,47,50,57,57,59,57],[65,59,57,64,73,70,63,60,67,78,88,96,83,63,75,109,119,113,80,45,50,56,59,61,58,53,49,48,60,82,88,87,71,55,55,47,61,63,60,62,56,57,59,59,56,55,47,47,50,56,69,64,52,64,65,51,52,49,55,59,57,60,56,55],[77,67,56,73,89,70,58,58,67,70,67,72,67,60,77,104,113,98,58,51,53,57,58,61,59,65,69,53,68,79,72,67,57,58,60,57,56,55,55,57,55,55,58,58,61,52,46,44,43,55,80,66,50,66,68,57,47,50,59,57,56,59,59,65],[74,68,67,77,82,74,60,52,58,54,57,60,60,58,79,103,102,75,65,70,62,57,64,62,61,70,65,63,81,89,69,51,56,67,61,51,52,47,47,63,62,53,51,57,56,55,55,57,49,56,65,74,66,65,65,57,51,50,57,60,60,62,65,66],[81,95,100,77,72,80,73,64,57,54,58,62,58,60,57,53,64,70,74,64,66,63,67,67,65,65,64,63,75,72,66,61,61,73,70,60,62,63,79,97,98,82,73,77,88,85,72,49,57,81,89,89,82,63,52,55,60,59,62,65,65,66,63,62],[133,133,105,80,82,88,82,81,67,57,57,67,67,63,52,42,58,64,58,56,61,61,62,67,68,68,65,66,67,61,63,67,70,79,79,73,70,79,92,111,112,110,106,95,89,98,87,49,63,97,99,100,87,65,52,57,59,65,62,50,58,65,59,52],[128,123,105,79,82,85,81,82,80,67,63,61,67,61,63,55,60,58,45,53,60,57,56,62,66,67,64,66,68,64,67,78,82,72,66,72,69,63,69,82,88,102,96,99,81,94,89,65,69,93,87,88,86,66,52,60,59,62,59,49,46,60,60,56],[82,100,86,65,79,81,80,90,80,58,56,56,53,48,53,50,61,58,55,57,56,53,56,57,63,64,67,66,66,67,70,81,82,78,72,71,66,56,59,52,81,95,96,105,93,87,74,69,82,81,72,69,74,65,60,66,66,60,56,50,46,68,66,56],[60,66,69,70,70,81,81,82,78,60,47,47,46,47,48,50,63,64,67,63,53,56,57,60,64,63,66,67,66,69,72,75,78,87,87,62,60,62,65,57,71,72,78,84,84,77,68,72,84,69,68,73,78,63,63,66,71,63,50,49,46,63,72,59],[52,66,69,61,64,75,77,70,67,58,48,47,53,60,51,45,48,60,64,64,57,61,61,63,64,63,67,74,69,67,67,71,87,92,89,63,56,59,59,63,54,50,63,66,64,69,65,69,71,63,69,78,72,59,62,66,65,63,52,49,55,54,50,55],[57,60,69,61,69,66,64,66,61,60,52,58,61,67,58,58,48,47,53,57,57,64,61,68,68,65,71,70,70,69,67,72,87,90,89,78,61,57,61,64,62,62,62,71,73,66,60,62,65,64,60,63,60,63,60,63,69,68,52,50,63,72,89,67],[55,57,58,48,50,53,61,67,64,64,68,67,72,74,61,64,58,46,50,51,58,69,74,78,70,65,73,75,75,63,66,73,75,79,80,81,65,47,50,71,72,71,62,74,86,82,80,66,62,62,63,65,63,65,58,56,62,62,52,73,103,115,125,124],[46,49,61,61,49,52,57,64,67,64,73,72,70,60,60,60,66,64,57,53,58,63,70,71,73,75,70,80,79,61,61,60,79,80,81,73,64,63,81,95,99,82,68,75,99,107,103,75,78,71,67,71,57,56,52,57,71,63,60,119,142,141,142,142],[45,43,57,79,64,48,60,68,64,61,69,74,61,50,56,53,63,66,61,53,53,50,56,67,75,73,76,88,87,109,116,110,107,110,96,89,104,105,122,119,110,92,75,79,99,118,105,63,63,82,74,68,57,56,56,66,69,65,72,125,143,163,161,154],[57,53,53,79,65,58,67,63,64,58,56,56,58,55,50,50,51,56,60,58,50,49,59,81,85,70,64,63,124,167,187,193,157,127,123,86,132,138,124,120,130,128,83,88,98,127,107,112,113,117,90,59,72,62,57,62,56,49,56,108,138,142,139,112],[58,57,66,74,63,63,66,63,56,48,47,47,56,59,57,52,56,57,57,56,56,93,118,114,93,74,86,171,213,220,200,202,206,182,150,118,133,149,154,184,185,158,118,119,114,130,155,168,142,124,103,59,63,68,51,49,49,40,57,66,98,100,93,94],[71,73,64,61,57,63,69,60,56,58,59,52,52,74,91,80,78,77,69,62,100,125,137,129,98,93,148,200,235,234,234,222,199,178,153,123,125,149,175,181,183,151,127,119,118,117,124,123,124,124,98,50,60,56,50,50,52,50,46,52,69,93,101,87],[105,114,77,49,51,60,64,57,58,98,100,100,93,74,95,94,79,92,85,85,118,141,154,132,98,93,150,201,235,234,235,227,164,143,118,118,105,150,153,151,149,113,102,103,95,73,71,72,108,126,78,49,50,50,50,50,55,50,49,56,62,78,79,69],[102,114,103,63,51,51,66,66,75,98,120,122,118,117,116,107,79,85,93,87,120,140,170,128,89,92,128,193,219,219,210,173,150,108,98,98,97,120,136,137,125,84,73,65,63,63,59,73,97,94,78,60,56,55,55,50,55,57,59,62,63,60,59,63],[120,119,114,93,73,48,56,69,68,65,113,137,148,150,133,116,83,101,101,84,111,128,126,103,90,94,102,139,172,171,168,175,154,107,98,98,81,79,118,134,113,73,60,62,62,63,62,66,63,69,63,49,47,56,55,53,50,55,59,68,60,61,57,60],[134,125,118,107,77,55,53,56,57,64,93,115,125,123,105,92,83,105,103,63,65,87,108,92,81,85,101,130,129,141,157,162,143,101,102,89,59,63,105,106,65,63,59,59,60,68,68,56,50,57,51,44,43,47,50,50,46,46,50,49,50,49,49,50],[122,122,118,106,78,64,62,51,56,83,88,103,107,105,89,69,82,106,98,52,74,116,101,77,63,61,65,93,118,126,125,110,102,100,106,89,63,65,66,63,67,65,60,62,56,66,66,55,57,66,56,43,44,47,49,47,46,44,44,46,52,56,51,49],[101,105,104,97,74,69,74,57,57,80,90,111,118,86,68,63,77,82,79,78,87,91,78,67,60,60,60,55,77,93,98,85,80,87,89,90,73,65,59,59,60,57,60,51,46,52,60,62,59,56,49,45,46,50,55,50,52,47,43,45,56,56,57,52],[94,80,80,81,73,65,60,57,61,64,63,86,86,65,56,56,60,72,87,97,66,50,62,74,64,57,55,57,71,80,73,69,67,70,66,67,72,66,62,60,54,46,49,44,46,44,59,62,55,49,44,43,44,49,52,49,50,49,49,50,50,55,54,52],[72,70,68,63,56,56,59,63,66,62,57,57,63,63,73,76,73,78,104,106,66,59,60,63,65,59,62,60,65,63,57,62,76,68,59,63,68,71,66,66,59,49,48,47,49,49,59,61,50,46,44,47,49,47,50,52,49,52,65,65,62,56,55,62],[63,58,51,49,50,60,71,72,64,64,63,62,60,70,78,89,85,74,95,108,89,74,59,56,59,57,57,59,56,56,60,63,63,68,65,68,71,76,68,76,62,46,48,50,52,50,55,61,52,49,51,47,47,47,56,74,60,56,62,74,73,57,62,65],[64,53,51,59,72,69,80,73,68,69,69,73,87,87,98,100,102,129,131,122,93,67,59,62,63,60,55,56,52,56,59,59,53,56,57,63,67,63,56,50,52,49,47,52,57,52,52,50,49,49,56,49,46,44,46,55,72,68,50,69,86,85,73,62],[50,47,52,72,72,57,73,80,79,85,89,92,99,99,101,137,154,172,172,135,95,58,60,63,63,60,56,57,59,59,59,57,51,48,49,50,46,44,43,43,49,46,49,53,50,47,46,45,41,40,40,42,44,41,47,59,92,108,85,76,120,121,87,57],[47,53,56,73,75,50,57,81,93,93,89,89,92,97,105,141,159,165,165,127,80,59,60,61,61,61,55,56,62,65,74,71,65,63,52,46,43,44,45,55,55,50,52,50,47,50,52,52,49,49,55,52,50,55,66,76,94,110,133,97,137,124,86,56],[56,67,66,69,71,52,59,82,89,95,88,73,74,75,102,127,126,108,77,67,78,63,60,60,58,60,66,60,62,71,84,88,84,72,63,49,49,49,56,57,57,55,49,50,49,44,57,71,59,62,59,62,60,62,66,74,81,108,107,103,129,122,74,60],[53,61,62,50,50,55,51,58,67,90,82,63,60,63,75,79,78,97,95,63,55,56,63,63,56,57,74,68,59,82,95,98,93,76,73,68,60,57,59,58,63,57,46,47,62,59,49,50,56,60,56,56,56,56,50,56,57,57,63,95,111,95,76,66],[53,53,45,39,39,40,41,40,60,75,61,57,58,63,62,59,62,69,72,55,55,59,60,63,58,61,62,62,60,82,92,103,88,55,63,74,59,57,57,55,57,56,46,44,72,80,63,67,69,50,55,55,50,47,46,44,44,49,63,73,69,71,73,72],[57,48,44,43,48,44,39,40,57,62,60,59,65,62,50,53,78,72,60,62,57,66,68,63,59,57,62,60,62,65,81,99,93,85,68,49,44,50,50,52,44,44,44,63,87,88,118,122,81,71,65,62,55,52,57,57,59,57,57,56,57,60,59,62],[50,41,45,49,55,57,44,43,55,57,59,62,62,56,50,52,72,81,82,82,79,68,66,65,62,60,60,62,65,49,88,117,128,133,110,56,43,43,48,52,49,49,47,68,111,138,146,146,108,75,68,66,60,57,59,65,57,51,60,71,65,66,59,55],[47,45,47,52,56,55,47,49,63,62,57,59,57,55,50,50,56,59,65,68,62,55,52,62,60,58,62,63,71,60,100,133,132,145,125,82,63,52,47,49,50,58,63,80,117,139,158,131,105,66,55,57,59,56,52,55,49,50,56,73,78,76,57,56],[48,44,48,56,56,55,52,55,55,58,56,55,56,55,55,56,46,41,43,44,46,44,49,55,58,60,62,65,74,78,102,140,148,145,130,106,63,57,55,50,56,47,62,80,105,128,128,90,89,60,46,49,50,49,50,52,52,74,98,107,105,78,63,66],[45,45,57,57,57,55,55,50,44,50,55,55,57,56,56,50,49,45,47,47,47,55,52,56,57,67,69,68,86,89,112,139,153,138,112,89,52,49,60,57,59,52,46,50,68,89,93,74,65,63,47,49,49,51,52,55,94,111,127,139,140,111,72,68],[45,45,51,57,53,52,49,52,53,51,58,58,56,57,55,55,53,46,48,47,49,62,59,56,57,71,71,69,74,91,115,127,134,111,81,51,44,47,57,49,57,71,47,40,49,79,78,65,56,62,60,52,49,52,52,74,100,116,131,158,140,115,79,67],[51,50,50,50,41,45,44,49,52,58,59,50,50,55,56,57,52,55,50,49,49,59,66,57,54,62,59,59,55,71,105,120,119,87,88,49,43,53,57,56,57,57,50,46,49,49,55,62,57,62,63,47,46,50,57,73,78,117,140,142,131,87,74,66],[50,46,48,45,47,47,47,50,56,53,52,47,52,50,52,55,59,68,59,49,56,60,62,60,59,60,63,59,62,68,68,92,90,83,87,52,47,57,61,62,49,35,39,40,44,41,55,65,63,63,50,43,44,47,56,60,58,111,141,103,81,80,71,61],[48,47,50,49,53,48,41,52,60,59,55,52,58,53,47,55,55,56,52,65,71,69,54,65,72,74,76,63,56,62,66,63,72,80,78,56,45,46,49,49,49,49,50,50,49,46,57,63,62,55,46,45,55,50,49,48,49,105,118,99,68,69,57,47],[48,48,48,49,48,51,52,50,57,60,55,55,58,58,57,57,59,57,57,71,73,74,68,74,72,74,69,62,59,59,66,73,63,64,65,65,64,94,98,97,77,74,68,71,56,44,51,60,47,40,43,46,55,56,47,36,47,78,103,102,71,69,59,60],[51,50,50,46,46,53,57,50,50,56,57,53,56,59,62,60,65,59,63,68,72,71,69,66,71,65,57,57,63,62,60,60,57,59,57,57,107,142,158,156,123,75,74,56,49,51,59,56,46,44,43,44,55,52,47,41,47,56,60,73,72,65,72,71],[49,48,50,49,46,49,52,49,50,48,47,49,54,57,57,55,57,59,62,63,62,58,57,56,62,54,51,55,57,62,59,55,57,68,83,128,164,180,180,165,160,131,110,52,55,57,60,62,59,52,44,41,47,49,47,47,55,58,50,49,57,55,62,68],[48,47,51,49,45,51,60,51,50,47,46,47,58,61,58,58,57,64,62,62,66,64,65,65,66,51,45,50,50,59,64,60,58,84,127,154,196,208,208,165,156,143,117,66,57,57,55,62,66,59,50,49,47,47,49,46,52,54,50,50,55,52,52,44],[55,47,45,46,48,56,51,47,50,56,58,68,73,90,92,80,63,70,66,60,60,61,69,69,63,53,56,55,53,53,63,66,65,89,121,156,198,216,207,163,123,129,116,70,52,57,55,57,53,47,57,56,56,56,49,44,44,47,50,55,55,55,44,35],[63,50,41,44,48,63,46,45,57,57,77,97,111,125,125,80,77,75,72,68,67,72,76,78,75,69,56,53,48,50,64,74,66,82,79,155,171,164,141,123,121,95,100,85,55,55,57,49,46,49,57,57,59,59,50,46,44,46,52,50,52,51,43,43],[57,53,47,46,62,66,51,44,57,78,113,135,132,136,119,80,79,79,66,69,86,106,98,88,82,65,53,60,52,48,72,86,67,55,59,106,117,119,147,155,128,89,86,87,71,52,49,49,54,52,51,60,60,62,59,52,47,44,46,49,47,46,47,44]];

var container=document.createElement('div'); document.body.appendChild(container);
var camera,frustum, scene, renderer,mesh,controls;
var instrow=30;
var instances = instrow*instrow;var clock = new THREE.Clock();
function init() {
	renderer = new THREE.WebGLRenderer({ antialias: true });

    scene = new THREE.Scene(); 
    camera = new THREE.PerspectiveCamera( 90, (window.innerWidth / window.innerHeight), 0.1, 100000 );
 	//camera.rotation.x=1;
    camera.position.set(img.width/2,img.height/2,instrow);
    //camera.position.set(0,0,instrow);
    camera.updateMatrix(); //cameraPerspectiveHelper = new THREE.CameraHelper( camera);scene.add( cameraPerspectiveHelper );

    controls  = new THREE.FlyControls(camera,container); 
    controls.rotateSpeed = 1.0;controls.zoomSpeed = 1.2;controls.panSpeed = 0.8;
    controls.movementSpeed = instrow/2;controls.rollSpeed = Math.PI / 12;
    controls.autoForward = false;controls.dragToLook = true;

    var geometry = new THREE.InstancedBufferGeometry();
    var vertices = new THREE.BufferAttribute( new Float32Array([1,1,0,0,1,0,1,0,0,0,0,0,]),3);
      geometry.addAttribute( 'position', vertices );
    var ids = new THREE.InstancedBufferAttribute( new Float32Array( instances ),1,1);
      for(var i=0;i<instances;i++) ids.setX(i,i);
      geometry.addAttribute( 'id', ids ); 

//for(var y=0;y<Math.ceil(img.width/instances);y++)
//for(var x=0;x<Math.ceil(img.width/instances);x++) {

//can=document.createElement('canvas'); can.width=instances; can.height=img.height
  THREE.ImageUtils.crossOrigin ='';
  var texture = THREE.ImageUtils.loadTexture('http://i.imgur.com/FCKORxV.jpg'); 
    //var texture = new THREE.Texture(can);
    texture.magFilter = texture.minFilter = THREE.NearestFilter;
    texture.needsUpdate=true;
  // mario.png
    texture.anisotropy = 0;

    var material = new THREE.RawShaderMaterial( {
        uniforms: {map: { type: "t", value: texture } ,
        pos : { type: "v4", value: new THREE.Vector4(0,0,0,0) },
        wid : { type: "f",  value: instrow*1. },
    	},
        vertexShader: 
          'precision highp float;\
          uniform mat4 modelViewMatrix; uniform mat4 projectionMatrix;\
          uniform sampler2D map; uniform vec4 pos; uniform float wid;\
          attribute vec3 position; attribute float id;\
          varying   float vid;\
          void main() { vid=id;\
              float y=floor(vid/wid),x=(vid-(y*wid));\
              vec4 h=texture2D(map,vec2(pos.x+(x*pos.z),pos.y+(y*pos.w)));\
              float z=((h.x+h.y+h.z)/3.)*10.;\
              gl_Position = projectionMatrix * modelViewMatrix *\
              	vec4( vec3(x,y,0)+position, 1.0 );\
          }',
        fragmentShader: 
          'precision highp float;\
          uniform sampler2D map; uniform vec4  pos; uniform float wid;\
          varying float vid;\
          void main() {\
              float y=floor(vid/wid),x=(vid-(y*wid));\
              vec4 h=texture2D(map,vec2(pos.x+(x*pos.z),pos.y+(y*pos.w)));\
              gl_FragColor = vec4(1,1,1,1);\
          }',
        //side: THREE.DoubleSide,
        transparent: false,
    } );
	geometry.computeBoundingSphere();
	geometry.boundingSphere.radius=instrow;
	geometry.boundingSphere.center.x+=(instrow/2);
	geometry.boundingSphere.center.y+=(instrow/2);

	dx=Math.ceil(img.width/instrow);
	dy=Math.ceil(img.height/instrow);
	for(var y=0;y<dy;y++)
	for(var x=0;x<dx;x++) {
		//x=-0.5;y=-0.5;
		var mat = material.clone();
		var u=(x*instrow)*(1./(dx*instrow)),ud=(1./(dx*instrow));
		var v=(y*instrow)*(1./(dy*instrow)),vd=(1./(dy*instrow));
		mat.uniforms['pos'].value=new THREE.Vector4( u, v,ud,vd );
		mat.needsRefresh=true;
		var mesh = new THREE.Mesh( geometry, mat );mesh.frustumCulled = true; 
		mesh.position.set(x*(instrow), y*(instrow), 0);
		mesh.updateMatrix();

		scene.add( mesh );//var bbHelper = new THREE.BoundingBoxHelper( mesh, 0xffffff );scene.add( bbHelper );bbHelper.update(); 
	}
	stats = new Stats(); container.appendChild( stats.dom ); 
    renderer.setClearColor( 0 ); renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize( window.innerWidth, window.innerHeight );
    container.appendChild( renderer.domElement );
    window.addEventListener( 'resize', onWindowResize, false );
  window.addEventListener( 'mousemove', onMouseMove, false );
}
function onWindowResize( event ) {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize( window.innerWidth, window.innerHeight );
}
mouseX=mouseY=0;
function animate() {
	var delta = clock.getDelta();
    requestAnimationFrame(animate);
    renderer.render( scene, camera );controls.update(delta);stats.update();
}
var halfWidth = window.innerWidth/2, halfHeight = window.innerHeight/2;
function onMouseMove( event ) {
  mouseX = event.clientX - halfWidth;
  mouseY = event.clientY - halfHeight;
}
init();
animate();

}}}}}}
